# Nginx Service Manager â€” REST API for Managing Nginx and Virtual Hosts

This project provides a Laravelâ€‘based REST API for:
- Managing the Nginx service (start/stop/restart/reload)
- Creating and deleting virtual hosts
- Autoâ€‘generating configuration files and HTML pages
- Controlling Nginx inside Docker via Ansible

---

## ğŸš€ Installation & Deployment

### 1. Clone the repository

```bash
git clone git@github.com:OleksandrMykhasuik/nginx-service-manager.git
cd nginx-service-manager
```
### 2. install composer dependencies
```bash
cd project
composer install
```
### 3. Build and start Docker environment

```bash
cd ../docker
docker compose up -d --build
```

This starts:
- `laravel-api` â€” REST API
- `ansible` â€” container used to control Nginx
- `nginx-managed` â€” Nginx instance managed by API

### 4. Generate laravel key
```bash
docker exec -it laravel-api bash
cp .env.example .env

cat <<EOF >> .env
ANSIBLE_HOST=ansible
ANSIBLE_USER=ansible
ANSIBLE_SSH_KEY=/var/www/.ssh/laravel_ansible
ANSIBLE_PATH=/etc/ansible
EOF

php artisan key:generate
```

### 5. Ensure SSH keys are correctly mounted

Your Docker volumes should contain:

- `laravel-ssh` â€” private key readable by Ansible
- `laravel-ssh-public` â€” public key injected into nginx-managed

### 6. Test connection from Ansible â†’ Nginx

```bash
docker exec -it ansible bash
ssh ansible@nginx-managed
```

If login works, API will be able to operate Nginx.

---

# ğŸ“¡ API Documentation

---

## ğŸ“Œ Nginx control endpoints

Base path:

```
/api/nginx
```

### â–¶ Start Nginx

```
POST /api/nginx/start
```

### â¹ Stop Nginx

```
POST /api/nginx/stop
```

### ğŸ”„ Restart Nginx

```
POST /api/nginx/restart
```

### â™» Reload Nginx config

```
POST /api/nginx/reload
```

All commands trigger Ansible playbooks that run inside the `ansible` container.

---

## ğŸ“ Virtual Hosts API

Base path:

```
/api/vhosts
```

### ğŸŸ¢ Create virtual host

```
POST /api/vhosts
```

#### JSON body example

```json
{
  "domain": "example.com",
  "port": 8001,
  "rootPath": "/var/www/example.com",
  "ssl": false,
  "sslCertPath": null,
  "sslKeyPath": null
}
```

### ğŸ”´ Delete virtual host

```
DELETE /api/vhosts/{domain}
```

Example:

```
DELETE /api/vhosts/example.com
```

---

# ğŸ§© Directory Structure

```
nginx-service-manager/
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ ansible/
â”‚   â”‚   â”œâ”€â”€ laravel-api/
â”‚   â”‚   â””â”€â”€ nginx-managed/
â”‚   â””â”€â”€ docker-compose.yaml
â”œâ”€â”€ project/        # Laravel application
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ ansible/    # playbooks, inventory
â”‚   â””â”€â”€ nginx/      # vhost configs generated by API
```

---

# ğŸ“ Example cURL Requests

### Create vhost

```bash
curl -X POST http://localhost/api/vhosts \
  -H "Content-Type: application/json" \
  -d '{
    "domain": "example.com",
    "port": 8001,
    "rootPath": "/var/www/example.com",
    "ssl": false
  }'
```

### Delete vhost

```bash
curl -X DELETE http://localhost/api/vhosts/example.com
```

---

# ğŸ›  Technologies Used

- Laravel 12 (PHP 8.3)
- Ansible 2.19
- Docker + Docker Compose
- Ubuntu 24.04 (nginx-managed image)
- Nginx latest
- SSH keyâ€‘based authentication between containers

---

# ğŸ“¬ Author

Oleksandr Mykhasuik  
GitHub: https://github.com/OleksandrMykhasuik/nginx-service-manager

